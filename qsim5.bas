5 REM 5-BIT REGISTER QUANTUM EMULATOR -*- mode:basic-trs80; -*-
10 DEFSNGA:DIMAA(4),AC(16),AE(64),AG(256),AI(1024),AK(4)
15 DEFINTI,J,K,L,N:DIMAB(4),AD(16),AF(64),AH(256),AJ(1024),AL(4)
20 NQ=5:NS=1:FORN=1TONQ:NS=2*NS:NEXT:DIMAM(NS-1),AN(NS-1),AO(NS-1),AP(NS-1)
30 FORN=0TONS-1:AM(N)=0.:AN(N)=0.:NEXT:AM(0)=1.
35 CLS
40 PRINT "TRS-80 5-bit QUANTUM SIMULATOR"
50 PRINT "ENTER GATE SEQ (X<N>,Y<N>,Z<N>,H<N>,S<N>,T<N>,E<N>,C<N>)"
60 INPUT G$
70 N=1
80 NN=VAL(MID$(G$,N+1,1)):IF"e"=MID$(G$,N,1)THENGOSUB800:GOTO110
90 IF"c"=MID$(G$,N,1)THENGOSUB850:GOTO110
100 GOSUB200   
110 N=N+2:IFN<LEN(G$)THEN80
120 END
    
200 REM DISPATCH 1-QUBIT GATES AND TENSORIZE
210 IFNN=0THENGOSUB410:GOSUB300ELSEGOSUB310:GOSUB300
215 IFNN=1THENGOSUB410ELSEGOSUB310    
220 FORI=0TO1:FORK=0TO1:FORJ=0TO1:FORL=0TO1:AC(4*(2*I+J)+(2*K+L))=AA(2*I+K)*AK(2*J+L)-AB(2*I+K)*AL(2*J+L):AD(4*(2*I+J)+(2*K+L))=AA(2*I+K)*AL(2*J+L)+AB(2*I+K)*AK(2*J+L):NEXTL,J,K,I
225 ?"> QUBIT 0 1 ";    
230 IFNN=2THENGOSUB410ELSEGOSUB310
240 FORI=0TO3:FORK=0TO3:FORJ=0TO1:FORL=0TO1:AE(8*(2*I+J)+(2*K+L))=AC(4*I+K)*AK(2*J+L)-AD(4*I+K)*AL(2*J+L):AF(8*(2*I+J)+(2*K+L))=AC(4*I+K)*AL(2*J+L)+AD(4*I+K)*AK(2*J+L):NEXTL,J,K,I
245 ?"2 ";    
250 IFNN=3THENGOSUB410ELSEGOSUB310
260 FORI=0TO7:FORK=0TO7:FORJ=0TO1:FORL=0TO1:AG(16*(2*I+J)+(2*K+L))=AE(8*I+K)*AK(2*J+L)-AF(8*I+K)*AL(2*J+L):AH(16*(2*I+J)+(2*K+L))=AE(8*I+K)*AL(2*J+L)+AF(8*I+K)*AK(2*J+L):NEXTL,J,K,I
265 ?"3 ";    
270 IFNN=4THENGOSUB410ELSEGOSUB310   
280 FORI=0TO15:FORK=0TO15:FORJ=0TO1:FORL=0TO1:AI(32*(2*I+J)+(2*K+L))=AG(16*I+K)*AK(2*J+L)-AH(16*I+K)*AL(2*J+L):AJ(32*(2*I+J)+(2*K+L))=AG(16*I+K)*AL(2*J+L)+AH(16*I+K)*AK(2*J+L):NEXTL,J,K,I
285 ?"4.":    
290 GOSUB 600:RETURN    
    
300 FORN0=0TO3:AA(N0)=AK(A0):AB(N0)=AL(N0):RETURN
310 AK(0)=1.:AK(1)=0.:AK(2)=0.:AK(3)=1.:AL(0)=0.:AL(1)=0.:AL(2)=0.:AL(3)=0.:RETURN    
  
410 IF"x"=MID$(G$,N,1)THENAK(0)=0.:AK(1)=1.:AK(2)=1.:AK(3)=0.:AL(0)=0.:AL(1)=0.:AL(2)=0.:AL(3)=0.:RETURN
420 IF"y"=MID$(G$,N,1)THENAK(0)=0.:AK(1)=0.:AK(2)=0.:AK(3)=0.:AL(0)=0.:AL(1)=-1.:AL(2)=1.:AL(3)=0:RETURN
430 IF"z"=MID$(G$,N,1)THENAK(0)=1.:AK(1)=0.:AK(2)=0.:AK(3)=-1.:AL(0)=0.:AL(1)=0.:AL(2)=0.:AL(3)=0.:RETURN
440 IF"h"=MID$(G$,N,1)THENAK(0)=1./sqr(2):AK(1)=AK(0):AK(2)=AK(0):AK(3)=-AK(0):AL(0)=0.:AL(1)=0.:AL(2)=0.:AL(3)=0.:RETURN
450 IF"s"=MID$(G$,N,1)THENAK(0)=1.:AK(1)=0.:AK(2)=0.:AK(3)=0.:AL(0)=0.:AL(1)=0.:AL(2)=0.:AL(3)=1.:RETURN
460 IF"t"=MID$(G$,N,1)THENAK(0)=1.:AK(1)=0.:AK(2)=0.:AK(3)=1/sqr(2):AL(0)=0.:AL(1)=0.:AL(2)=0.:AL(3)=AK(3):RETURN
470 RETURN
    
600 REM MATRIX x VECTOR
610 FORN0=0TONS-1:AO(N0)=0.:AP(N0)=0:FORNI=0TO31:AO(N0)=AO(N0)+AM(NI)*AI(32*N0+NI)-AN(NI)*AJ(32*N0+NI):AP(N0)=AP(N0)+AM(NI)*AJ(32*N0+NI)+AN(NI)*AI(32*N0+NI):NEXT NI,N0
620 FORN0=0TONS-1:AM(N0)=AO(N0):AN(N0)=AP(N0):NEXT
630 REM COMPUTE AND DISPLAY PROBABILITIES
640 FORN0=0TONS-1:AP(N0)=AM(N0)*AM(N0)+AN(N0)*AN(N0):NEXT
650 CLS:FORN0=0TONS-4STEP4:
660 ?USING"##";N0;:?" ";:?USING"#.##";AM(N0);:?" ";
670 ?USING"##";N0+1;:?" ";:?USING"#.##";AM(N0+1);:?" ";
680 ?USING"##";N0+2;:?" ";:?USING"#.##";AM(N0+2);:?" ";
690 ?USING"##";N0+3;:?" ";:?USING"#.##";AM(N0+3);:?CHR$(149);
700 ?USING"##";N0;:?" ";:?USING"#.##";AN(N0);:?" ";
710 ?USING"##";N0+1;:?" ";:?USING"#.##";AN(N0+1);:?" ";
720 ?USING"##";N0+2;:?" ";:?USING"#.##";AN(N0+2);:?" ";
730 ?USING"##";N0+3;:?" ";:?USING"#.##";AN(N0+3)
740 NEXT
750 RETURN

800 REM SWAP NN,NN+1 GATES
810 GOSUB900:ONNN+1GOSUB920,980,1030,1090
820 ?"> SWAP.":GOSUB600:RETURN

850 REM CNOT NN,NN+1 GATES    
860 GOSUB900:ONNN+1GOSUB1130,1190,1240,1300
870 ?"> CNOT.":GOSUB600:RETURN
    
900 REM MONSTER MATRICES
900 AA(0)=1.:AA(1)=0.:AA(2)=0.:AA(3)=1.
910 AK(0)=1.:AK(1)=0.:AK(2)=0.:AK(3)=1.:RETURN
920 FORI=0TO15:AC(I)=0.:NEXT:AC(0)=1:AC(6)=1:AC(9)=1:AC(15)=1
930 AK(0)=1.:AK(1)=0.:AK(2)=0.:AK(3)=1.
940 FORI=0TO3:FORK=0TO3:FORJ=0TO1:FORL=0TO1:AE(8*(2*I+J)+(2*K+L))=AC(4*I+K)*AK(2*J+L):AF(8*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
950 FORI=0TO7:FORK=0TO7:FORJ=0TO1:FORL=0TO1:AG(16*(2*I+J)+(2*K+L))=AE(8*I+K)*AK(2*J+L):AH(16*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
960 FORI=0TO15:FORK=0TO15:FORJ=0TO1:FORL=0TO1:AI(32*(2*I+J)+(2*K+L))=AG(16*I+K)*AK(2*J+L):AJ(32*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
970 RETURN
980 FORI=0TO15:AC(I)=0.:NEXT:AC(0)=1:AC(6)=1:AC(9)=1:AC(15)=1
990 FORI=0TO1:FORK=0TO1:FORJ=0TO3:FORL=0TO3:AE(8*(4*I+J)+(4*K+L))=AA(2*I+K)*AC(4*J+L):AF(8*(4*I+J)+(4*K+L))=0.:NEXTL,J,K,I
1000 FORI=0TO7:FORK=0TO7:FORJ=0TO1:FORL=0TO1:AG(16*(2*I+J)+(2*K+L))=AE(8*I+K)*AK(2*J+L):AH(16*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
1010 FORI=0TO15:FORK=0TO15:FORJ=0TO1:FORL=0TO1:AI(32*(2*I+J)+(2*K+L))=AG(16*I+K)*AK(2*J+L):AJ(32*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
1020 RETURN
1030 FORI=0TO1:FORK=0TO1:FORJ=0TO1:FORL=0TO1:AC(4*(2*I+J)+(2*K+L))=AA(2*I+K)*AK(2*J+L):AD(4*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
1040 FORI=0TO15:AD(I)=0.:NEXT:AD(0)=1:AD(6)=1:AD(9)=1:AD(15)=1
1050 FORI=0TO3:FORK=0TO3:FORJ=0TO3:FORL=0TO3:AG(16*(4*I+J)+(4*K+L))=AC(4*I+K)*AD(4*J+L):AH(16*(4*I+J)+(4*K+L))=0.:NEXTL,J,K,I
1060 FORI=0TO15:FORK=0TO15:FORJ=0TO1:FORL=0TO1:AI(32*(2*I+J)+(2*K+L))=AG(16*I+K)*AK(2*J+L):AJ(32*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
1070 RETURN
1090 FORI=0TO1:FORK=0TO1:FORJ=0TO1:FORL=0TO1:AC(4*(2*I+J)+(2*K+L))=AA(2*I+K)*AK(2*J+L):AD(4*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
1100 FORI=0TO3:FORK=0TO3:FORJ=0TO1:FORL=0TO1:AE(8*(2*I+J)+(2*K+L))=AC(4*I+K)*AK(2*J+L):AF(8*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
1100 FORI=0TO15:AD(I)=0.:NEXT:AD(0)=1:AD(6)=1:AD(9)=1:AD(15)=1
1110 FORI=0TO7:FORK=0TO7:FORJ=0TO3:FORL=0TO3:AI(32*(4*I+J)+(4*K+L))=AE(8*I+K)*AD(4*J+L):AJ(32*(4*I+J)+(4*K+L))=0.:NEXTL,J,K,I
1120 RETURN
1130 FORI=0TO15:AC(I)=0.:NEXT:AC(0)=1:AC(5)=1:AC(11)=1:AC(14)=1
1140 AK(0)=1.:AK(1)=0.:AK(2)=0.:AK(3)=1.
1150 FORI=0TO3:FORK=0TO3:FORJ=0TO1:FORL=0TO1:AE(8*(2*I+J)+(2*K+L))=AC(4*I+K)*AK(2*J+L):AF(8*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
1160 FORI=0TO7:FORK=0TO7:FORJ=0TO1:FORL=0TO1:AG(16*(2*I+J)+(2*K+L))=AE(8*I+K)*AK(2*J+L):AH(16*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
1170 FORI=0TO15:FORK=0TO15:FORJ=0TO1:FORL=0TO1:AI(32*(2*I+J)+(2*K+L))=AG(16*I+K)*AK(2*J+L):AJ(32*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
1180 RETURN
1190 FORI=0TO15:AC(I)=0.:NEXT:AC(0)=1:AC(5)=1:AC(11)=1:AC(14)=1
1200 FORI=0TO1:FORK=0TO1:FORJ=0TO3:FORL=0TO3:AE(8*(4*I+J)+(4*K+L))=AA(2*I+K)*AC(4*J+L):AF(8*(4*I+J)+(4*K+L))=0.:NEXTL,J,K,I
1210 FORI=0TO7:FORK=0TO7:FORJ=0TO1:FORL=0TO1:AG(16*(2*I+J)+(2*K+L))=AE(8*I+K)*AK(2*J+L):AH(16*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
1220 FORI=0TO15:FORK=0TO15:FORJ=0TO1:FORL=0TO1:AI(32*(2*I+J)+(2*K+L))=AG(16*I+K)*AK(2*J+L):AJ(32*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
1230 RETURN
1240 FORI=0TO1:FORK=0TO1:FORJ=0TO1:FORL=0TO1:AC(4*(2*I+J)+(2*K+L))=AA(2*I+K)*AK(2*J+L):AD(4*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
1250 FORI=0TO15:AD(I)=0.:NEXT:AD(0)=1:AD(5)=1:AD(11)=1:AD(14)=1
1260 FORI=0TO3:FORK=0TO3:FORJ=0TO3:FORL=0TO3:AG(16*(4*I+J)+(4*K+L))=AC(4*I+K)*AD(4*J+L):AH(16*(4*I+J)+(4*K+L))=0.:NEXTL,J,K,I
1270 FORI=0TO15:FORK=0TO15:FORJ=0TO1:FORL=0TO1:AI(32*(2*I+J)+(2*K+L))=AG(16*I+K)*AK(2*J+L):AJ(32*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
1280 RETURN
1300 FORI=0TO1:FORK=0TO1:FORJ=0TO1:FORL=0TO1:AC(4*(2*I+J)+(2*K+L))=AA(2*I+K)*AK(2*J+L):AD(4*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
1310 FORI=0TO3:FORK=0TO3:FORJ=0TO1:FORL=0TO1:AE(8*(2*I+J)+(2*K+L))=AC(4*I+K)*AK(2*J+L):AF(8*(2*I+J)+(2*K+L))=0.:NEXTL,J,K,I
1310 FORI=0TO15:AD(I)=0.:NEXT:AD(0)=1:AD(5)=1:AD(11)=1:AD(14)=1
1320 FORI=0TO7:FORK=0TO7:FORJ=0TO3:FORL=0TO3:AI(32*(4*I+J)+(4*K+L))=AE(8*I+K)*AD(4*J+L):AJ(32*(4*I+J)+(4*K+L))=0.:NEXTL,J,K,I
1340 RETURN
    
